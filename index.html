
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html version="-//W3C//DTD XHTML 1.1//EN"
      xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.w3.org/1999/xhtml
                          http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd">
<head>
    <title>Easymeter</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/xdate.js"></script>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

        var socket = io.connect();

        // Load the Visualization API and the piechart package.
        google.load('visualization', '1.1', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization library is loaded.
        google.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        var options = {
            title: 'Verbrauch der letzten zwei Minuten',
            width: 960,
            height: 440,
            animation: {
                duration: 1000,
                easing: 'in'
            }
        };

        var chart;
        var data = [
            ['Uhrzeit', 'Verbrauch']
        ];

        function drawChart() {
            chart = new google.visualization.LineChart(document.getElementById('chart_div'));

            socket.on('data', function (rawData) {
                var date = new XDate(new Date(rawData.date));
                data.push([date.toString("HH:mm:ss"), rawData.counter]);

                if (data.length >= 60) {
                    data.splice(1, 1);
                }

                renderData();
            });
        }

        function renderData() {
            var gData = google.visualization.arrayToDataTable(data);
            chart.draw(gData, options);
        }
    </script>
</head>
<body>
<div id="chart_div"></div>
</body>
</html>